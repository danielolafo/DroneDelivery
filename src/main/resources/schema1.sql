SET SEARCH_PATH TO dronedeliv;
CREATE SCHEMA IF NOT EXISTS dronedeliv;
--USE droneliv;

DROP TABLE IF EXISTS DRONES CASCADE;
CREATE TABLE DRONES(
    ID  UUID PRIMARY KEY,
    NAME VARCHAR(50),
    CODE VARCHAR(50),
    CAPACITY NUMERIC(3,2),
    BATTERY_AUTONOMY NUMERIC(3,2)
);

DROP TABLE IF EXISTS CUSTOMERS CASCADE;
CREATE TABLE CUSTOMERS(
    ID  UUID PRIMARY KEY,
    NAME VARCHAR(50),
    BUSINESS_TYPE VARCHAR(100)

);

DROP TABLE IF EXISTS CUSTOMER_LOCATIONS CASCADE;
CREATE TABLE CUSTOMER_LOCATIONS(
	ID  UUID PRIMARY KEY,
    CUSTOMER_ID UUID NOT NULL REFERENCES CUSTOMERS(ID),
    ADDRESS VARCHAR(100),
    CITY INT NOT NULL
);

DROP TABLE IF EXISTS DRONE_MAINTENANCES CASCADE;
CREATE TABLE DRONE_MAINTENANCES(
    ID  UUID PRIMARY KEY,
    DRONE_ID UUID NOT NULL REFERENCES DRONES(ID),
    MAINTENANCE_DATE DATE NOT NULL,
    COST NUMERIC(20,2)
);

DROP TABLE IF EXISTS DISPATCHES CASCADE;
CREATE TABLE DISPATCHES(
    ID  UUID PRIMARY KEY,
    ORIGIN VARCHAR(100),
    TARGET VARCHAR(100),
    CUSTOMER_ID UUID NOT NULL REFERENCES CUSTOMERS(ID),
    DRONE_ID UUID NOT NULL REFERENCES DRONES(ID),
    PAYMENT_VALUE NUMERIC(20,2),
    PAYMENT_METHOD INT NOT NULL,
    START_DATE DATE NOT NULL,
    END_DATE DATE,    
    KM_DONE NUMERIC(3,2)
);

DROP TABLE IF EXISTS PRODUCTS CASCADE;
CREATE TABLE PRODUCTS(
    ID  UUID PRIMARY KEY,
    NAME VARCHAR(50),
    QUANTITY NUMERIC(3,2),
    UNIT_PRICE NUMERIC(20,2),
    STOCK_QUANTITY NUMERIC(3,2),
    BRAND VARCHAR(100)
);

DROP TABLE IF EXISTS DISPATCH_CART CASCADE;
CREATE TABLE DISPATCH_CART(
	ID  UUID PRIMARY KEY,
    PRODUCT_ID UUID NOT NULL REFERENCES PRODUCTS(ID),
    DISPATCH_ID UUID NOT NULL REFERENCES DISPATCHES(ID),
    UNIT_WEIGHT NUMERIC(3,2),
    QUANTITY NUMERIC(3,2),
    TOTAL_WEIGHT NUMERIC(3,2),
    COST NUMERIC(20,2)
);

DROP TABLE IF EXISTS DISPATCH_COMMENTS CASCADE;
CREATE TABLE DISPATCH_COMMENTS(
	ID  UUID PRIMARY KEY,
    DISPATCH_ID UUID NOT NULL REFERENCES DISPATCHES(ID),
    DISPATCH_COMMENT VARCHAR(250) NOT NULL,
    DISPATCH_RATING NUMERIC(3,2)
);

ALTER TABLE DISPATCHES ADD CREATION_DATE DATE NOT NULL DEFAULT NOW();
